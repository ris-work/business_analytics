SELECT T_TBLINVDETAILS.INVDET_PROCODE as productcode, LEFT(convert(varchar, T_TBLINVHEADER.INVHED_TXNDATE, 126), 10) as daydate, RIGHT(LEFT(convert(varchar, T_TBLINVHEADER.INVHED_TIME, 126), 13), 2) as timehour,  SUM(T_TBLINVDETAILS.INVDET_UNITQTY) as qty, SUM(INVDET_AMOUNT) AS sumsell, SUM(INVDET_PROCOST * INVDET_UNITQTY) AS sumcost FROM T_TBLINVHEADER INNER JOIN T_TBLINVDETAILS ON T_TBLINVHEADER.INVHED_SETUPLOC = T_TBLINVDETAILS.INVDET_SETUPLOC AND T_TBLINVHEADER.INVHED_LOCCODE = T_TBLINVDETAILS.INVDET_LOCCODE AND T_TBLINVHEADER.INVHED_INVNO = T_TBLINVDETAILS.INVDET_INVNO AND T_TBLINVHEADER.INVHED_MODE = T_TBLINVDETAILS.INVDET_MODE WHERE (T_TBLINVHEADER.INVHED_CANCELED = 0) AND (T_TBLINVHEADER.INVHED_INVOICED = 1) AND (T_TBLINVHEADER.INVHED_LOCCODE IN ('001')) AND (T_TBLINVDETAILS.INVDET_VOID = 0)  AND (T_TBLINVHEADER.INVHED_MODE = 'INV') GROUP BY T_TBLINVDETAILS.INVDET_PROCODE, LEFT(convert(varchar, T_TBLINVHEADER.INVHED_TXNDATE, 126), 10), RIGHT(LEFT(convert(varchar, T_TBLINVHEADER.INVHED_TIME, 126), 13), 2) ORDER BY productcode, daydate, timehour
