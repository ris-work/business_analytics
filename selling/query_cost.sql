SELECT a.code, max(a.sell) FROM (SELECT DISTINCT INVDET_PROCODE AS code, INVDET_PROSELLING AS sell, INVDET_TXNDATE as date FROM T_TBLINVDETAILS WHERE LEN(INVDET_PROCODE)=6) a JOIN (SELECT INVDET_PROCODE AS code, MAX(INVDET_TXNDATE) AS date FROM T_TBLINVDETAILS GROUP BY INVDET_PROCODE) b ON a.code = b.code AND a.date = b.date GROUP BY a.code;
